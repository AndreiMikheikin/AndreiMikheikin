function validateForm(){const e=document.getElementById("email").value,t=document.getElementById("password").value,o=document.getElementById("confirm-password").value,n=""!==e,s=""!==t,a=""!==document.getElementById("role").value,l="Регистрация"===document.getElementById("form-title").textContent,r=t.length>=8,d=/[a-z]/.test(t),i=/[A-Z]/.test(t),c=/[0-9]/.test(t),m=t===o,g=r&&d&&i&&c&&m,u=document.getElementById("submit-btn");u.disabled=l?!(n&&s&&a&&g):!(n&&s&&a),u.classList.toggle("active",!u.disabled),document.getElementById("password-requirements").style.display=l?"block":"none",toggleCheckMark("length-check",r),toggleCheckMark("lowercase-check",d),toggleCheckMark("uppercase-check",i),toggleCheckMark("number-check",c),toggleCheckMark("match-check",m)}function toggleCheckMark(e,t){document.getElementById(e).querySelector(".check").style.display=t?"inline-block":"none"}function selectRole(e){document.getElementById("role").value=e;document.querySelectorAll(".role-selection button").forEach(e=>e.classList.remove("selected")),document.querySelector(`.role-selection button.${e}`).classList.add("selected"),validateForm()}async function handleSubmit(e){e.preventDefault();const t=e.target.email.value,o=e.target.password.value,n=e.target.role.value,s="Регистрация"===document.getElementById("form-title").textContent;try{if(s){const e=await createUserWithEmailAndPassword(auth,t,o);console.log("User registered:",e.user);const s=e.user;await setDoc(doc(db,"users",s.uid),{email:s.email,role:n,createdAt:new Date}),console.log("User added to Firestore"),showWelcomeModal(s.email),showPanel(n)}else{const e=await signInWithEmailAndPassword(auth,t,o);console.log("User signed in:",e.user),showWelcomeModal(e.user.email),showPanel(n)}}catch(e){console.error("Authentication error:",e),alert("Ошибка при выполнении действия. Повторите попытку.")}}function showPanel(e){if(document.getElementById("auth-container").style.display="none",document.getElementById("admin-dashboard-container").style.display="admin"===e?"block":"none",document.getElementById("user-dashboard-container").style.display="user"===e?"block":"none","admin"!==e&&"user"!==e)return console.error("Неизвестная роль:",e),void alert("Ошибка: неизвестная роль пользователя.")}function toggleForm(){const e=document.getElementById("form-title"),t=document.getElementById("confirm-password"),o=document.getElementById("password-requirements"),n=document.getElementById("submit-btn"),s="Вход"===e.textContent,a=document.getElementById("toggle-link");document.getElementById("email").value="",document.getElementById("password").value="",document.getElementById("confirm-password").value="";document.querySelectorAll(".check").forEach(e=>e.style.display="none"),e.textContent=s?"Регистрация":"Вход",a.textContent=s?"Есть аккаунт? Авторизация":"Нет аккаунта? Регистрация",t.classList.toggle("hidden",!s),o.classList.toggle("hidden",!s),n.textContent=s?"Зарегистрироваться":"Войти",validateForm()}function logout(){signOut(auth).then(()=>{console.log("User signed out"),document.getElementById("auth-container").style.display="block",document.getElementById("admin-dashboard-container").style.display="none",document.getElementById("user-dashboard-container").style.display="none"}).catch(e=>{console.error("Error signing out:",e),alert("Ошибка при выходе.")})}function toggleForgotPasswordForm(){const e=document.getElementById("auth-container"),t=document.getElementById("forgot-password-container");t.classList.contains("hidden")?(e.classList.add("hidden"),t.classList.remove("hidden")):(t.classList.add("hidden"),e.classList.remove("hidden"))}function validateForgotPasswordForm(){const e=""!==document.getElementById("forgot-email").value,t=document.getElementById("forgot-submit-btn");t.disabled=!e,t.classList.toggle("active",e)}function handleForgotPassword(e){e.preventDefault();const t=e.target["forgot-email"].value;fetchSignInMethodsForEmail(auth,t).then(e=>{if(0!==e.length)return sendPasswordResetEmail(auth,t).then(()=>{console.log("Password reset email sent"),alert("Ссылка для сброса пароля отправлена.")}).catch(e=>{console.error("Error sending password reset email:",e),alert("Ошибка при отправке ссылки для сброса пароля.")});alert("Пользователь с таким email не найден.")}).catch(e=>{console.error("Error checking email:",e),alert("Ошибка при проверке email.")})}import{initializeApp,getApps,getApp}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,sendPasswordResetEmail,signOut,fetchSignInMethodsForEmail}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{getFirestore,doc,setDoc}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";import{showWelcomeModal}from"../src/main.js";const firebaseConfig={apiKey:"AIzaSyAjJIU3lCSJivMJ9UbihXD1dqu8ivf-8OU",authDomain:"menuhelperapp.firebaseapp.com",projectId:"menuhelperapp",storageBucket:"menuhelperapp.appspot.com",messagingSenderId:"118002716868",appId:"1:118002716868:web:2623db6910ab0771c87991"},app=getApps().length?getApp():initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);window.validateForm=validateForm,window.selectRole=selectRole,window.handleSubmit=handleSubmit,window.toggleForm=toggleForm,window.logout=logout,window.toggleForgotPasswordForm=toggleForgotPasswordForm,window.validateForgotPasswordForm=validateForgotPasswordForm,window.handleForgotPassword=handleForgotPassword;