function validateForm(){const e=document.getElementById("email").value,t=document.getElementById("password").value,o=document.getElementById("confirm-password").value,n=""!==e,l=""!==t,s=""!==document.getElementById("role").value,d="Регистрация"===document.getElementById("form-title").textContent,a=t.length>=8,r=/[a-z]/.test(t),c=/[A-Z]/.test(t),i=/[0-9]/.test(t),m=t===o,g=a&&r&&c&&i&&m,u=document.getElementById("submit-btn");u.disabled=d?!(n&&l&&s&&g):!(n&&l),u.classList.toggle("active",!u.disabled),document.getElementById("password-requirements").style.display=d?"block":"none",toggleCheckMark("length-check",a),toggleCheckMark("lowercase-check",r),toggleCheckMark("uppercase-check",c),toggleCheckMark("number-check",i),toggleCheckMark("match-check",m)}function toggleCheckMark(e,t){document.getElementById(e).querySelector(".check").style.display=t?"inline-block":"none"}function selectRole(e){document.getElementById("role").value=e,document.getElementById("admin-role-btn").classList.toggle("selected","admin"===e),document.getElementById("user-role-btn").classList.toggle("selected","user"===e),validateForm()}async function getUserRole(e){try{const t=doc(db,"users",e),o=await getDoc(t);if(o.exists())return o.data().role;throw new Error("User not found")}catch(e){return console.error("Error fetching user role:",e),null}}async function handleSubmit(e){e.preventDefault();const t=document.getElementById("email").value,o=document.getElementById("password").value;try{const e=(await signInWithEmailAndPassword(auth,t,o)).user;showPanel(await getUserRole(e.uid)),showWelcomeModal(e.email)}catch(e){console.error("Login error:",e),alert("Ошибка при входе. Пожалуйста, попробуйте снова.")}}function showPanel(e){document.getElementById("auth-container").style.display="none","admin"===e?document.getElementById("admin-dashboard-container").style.display="block":"user"===e?document.getElementById("user-dashboard-container").style.display="block":(console.error("Unknown role:",e),alert("Ошибка: неизвестная роль пользователя."))}function toggleForm(){if((document.getElementById("email").value||document.getElementById("password").value)&&!confirm("Вы уверены, что хотите переключить форму? Все введенные данные будут потеряны."))return;const e=document.getElementById("form-title"),t=document.getElementById("confirm-password"),o=document.getElementById("password-requirements"),n=document.getElementById("submit-btn"),l=document.getElementById("toggle-link"),s=document.getElementById("admin-role-btn"),d=document.getElementById("user-role-btn"),a="Вход"===e.textContent;document.getElementById("email").value="",document.getElementById("password").value="",document.getElementById("confirm-password").value="";document.querySelectorAll(".check").forEach(e=>e.style.display="none"),e.textContent=a?"Регистрация":"Вход",l.textContent=a?"Есть аккаунт? Авторизация":"Нет аккаунта? Регистрация",t.classList.toggle("hidden",!a),o.classList.toggle("hidden",!a),n.textContent=a?"Зарегистрироваться":"Войти",s.classList.toggle("hidden",!a),d.classList.toggle("hidden",!a),validateForm()}function logout(){signOut(auth).then(()=>{alert("Вы вышли из аккаунта"),document.getElementById("auth-container").style.display="block",document.getElementById("admin-dashboard-container").style.display="none",document.getElementById("user-dashboard-container").style.display="none"}).catch(e=>{console.error("Logout error:",e),alert("Ошибка при выходе. Попробуйте снова.")})}function toggleForgotPasswordForm(){const e=document.getElementById("auth-container"),t=document.getElementById("forgot-password-container");t.classList.contains("hidden")?(e.classList.add("hidden"),t.classList.remove("hidden")):(t.classList.add("hidden"),e.classList.remove("hidden"))}function validateForgotPasswordForm(){const e=""!==document.getElementById("forgot-email").value,t=document.getElementById("forgot-submit-btn");t.disabled=!e,t.classList.toggle("active",e)}function handleForgotPassword(e){e.preventDefault();const t=document.getElementById("forgot-email").value;fetchSignInMethodsForEmail(auth,t).then(e=>{if(0!==e.length)return sendPasswordResetEmail(auth,t).then(()=>{alert("Ссылка для сброса пароля отправлена. Проверьте ваш почтовый ящик.")});alert("Пользователь с таким email не найден. Проверьте корректность данных.")}).catch(e=>{console.error("Password reset error:",e),alert("Ошибка при отправке ссылки для сброса пароля.")})}import{signInWithEmailAndPassword,sendPasswordResetEmail,signOut}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";import{doc,getDoc}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";import{showWelcomeModal,auth,db}from"../src/main.js";window.validateForm=validateForm,window.selectRole=selectRole,window.handleSubmit=handleSubmit,window.toggleForm=toggleForm,window.logout=logout,window.toggleForgotPasswordForm=toggleForgotPasswordForm,window.validateForgotPasswordForm=validateForgotPasswordForm,window.handleForgotPassword=handleForgotPassword;